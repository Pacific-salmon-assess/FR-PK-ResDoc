# Methods  

We compiled available data on pink salmon spawner abundance estimates and harvest and then developed and fit a state-space spawner-recruitment model to it to characterize stock dynamics and population characteristics. 
We then derived estimates of biological benchmarks to assess stock status and summarize trends. 
Lastly, we developed a simple closed-loop simulation model to quantify future expected biological and fishery performance of the current and alternative harvest control rules for the Fraser River Pink salmon stock. 
Each of these steps is described in more detail below. 

## Data sources  

Escapement and catch data was provided by *the Pacific Salmon Commission (PSC - or no?)*. 
There has been concern about the comparability of sampling regimes (@grantFraserRiverPink2014; @hagueMovingTargetsAssessing2021); and some analyses have discounted data prior to 1993 (*cite salmon scanner, others?*).  
We used the description of methods in @grantFraserRiverPink2014 and knowledge from local area staff to estimate relative accuracy among sampling stanzas; no evidence suggested estimates should be systematically biased low or high, but we assumed there was variable accuracy among methods (Table \@ref(ref:spawner-est-methods)). 
We also gathered average Fraser Pink body mass data from @pacificsalmoncommissionPSCBiologicalData2023 and abundance of Pinks in the North Pacific from @ruggeroneNumbersBiomassNatural2018 for biological context.  


## Spawner-recruit model  

We modeled the spawner-recruit data in a state-space framework with auto-correlated (AR1) recruitment residuals. 
State-space models allow for the separation of observation (e.g. sampling error) and process (e.g. true variability) noise and have become popular in ecological modelling [@auger-metheGuideStateSpace2021]. 
Incorporating an AR1 structure in recruitment residuals allowed us to examine if there were serially correlated process error from one generation to the next that could arise from large scale drivers like favorable ocean conditions or carryover effects (*cite*).  
In spawner-recruit modelling this approach has been demonstrated to yield less biased estimates of biological parameters than traditional, static spawner-recruit models since it minimizes errors that can arise from errors-in-variables and time series bias [@adkisonReviewSalmonSpawnerRecruitment2021; @fleischmanAgestructuredStatespaceStock2013; @statonEvaluationMethodsSpawner2020; @suPerformanceBayesianStatespace2012].


## Process model  

## Observation model  

This approach was particularly useful for this data set since we expected observation error in escapement to vary among sampling regimes (Table \@ref(tab:spawner-est-methods)).  
Since catch was heavily monitored and methods had not changed much through the years, catch CV was assumed to be 0.05.


 

Our state-space spawner-recruit model with auto-correlated recruitment residuals took the form: 

\begin{equation}
log(R_{y}) = log(S_{y}) + log(\alpha) - \beta S_{y} + \phi log(R_{y-1}/\hat{R}_{y-1})+r_{y}
\label{eq:SR}
\end{equation}

Where $R_y$ and $S_y$ are recruits and spawners from brood year $y$; $\alpha$ and $\beta$ are intrinsic growth rate and density dependence, respectively; $\phi$ is the degree of autocorrelation in recruitment from one year to the next; $R_{y-1}$ and $\hat{R}_{y-1}$ are the observed and expected recruitment in the previous generation; and $r_y$ is the residual variation in recruitment. 

Priors were weakly informative with: 
\begin{align*}
log(\alpha) &\sim {\sf Norm}(0, 3)\\
\beta &\sim {\sf Norm}(0, 1)\\
r &\sim {\sf Norm}(0, 2)\\
log(r_{0}) &\sim {\sf Norm}(0,20)\\
log(\overline{r}_{0}) &\sim {\sf Norm}(0,20)\\
\sigma r_{0} &\sim {\sf InvGamma}(2,1)\\
\end{align*}

where $log(\overline{r}_{0})$ and $\sigma r_{0}$ are the mean and variance of the first recruitment state, and $log(r_{0})$ describes variance at the second recruitment state.

Analyses were conducted in R and Stan via the rstan package [@rcoreteamLanguageEnvironmentStastical2019; @standevelopmentteamRstanInterfaceStan2023].
$\hat{R}$ were all less than 1.01, there were no divergent transitions and ESS was all greater than 400. 
We visually checked recruitment residuals to determine if this model would benefit from time-varying parameters.  


### Benchmark estimation  

We estimated $S_{MSY}$ (*Scheuerell 2016*):

$U_{MSY}$: 

and $S_{Gen}$:
**Just fire these in a table? someone said that before**

which were used as biological benchmarks to inform HCRs and evaluate their performance.  
We took 80% of $S_{MSY}$ as that is what is suggested and evaluated as a suitable upper benchmark for salmon (*DFO 2009 fishery decision making frmwrk, Holt et al 2009*). 


## Assessment: forward simulations  

Closed loop forward simulations used the existing state-space spawner-recruit model (Equation \@ref(eq:SR)) and projected population dynamics 5 generations forward (10 years). 
Simulations were done with the current and alternate HCRs with population dynamics reflecting the modeled spawner-recruit relationship, and also included a robustness test where productivity was reduced to 10% of the estimated parameters.  


### Harvest control rules tested  

We tested one HCR that was based on the precautionary approach, where the exploitation rate (ER) is 0% when recruits are under $S_{gen}$; when recruits are between $S_{gen}$ and $U_{MSY}$ the ER increases linearly from 0% to $U_{MSY}$, then remains at $U_{MSY}$. 
This HCR makes sense intuitively, but is impractical for fisheries management; (**Help me AMH!**). 
A similar HCR that works with management anchors the lower operational control point (OCP) at $S_{gen}$ and the upper OCP is a function of $S_{gen}$ and $U_{MSY}$ where:  

\begin{equation}
OCP_{upper} = OCP_{lower} / (1 - U_{MSY})
\label{eq:UpperOCP}
\end{equation}  

When the recruits are below $S_{gen}$ the ER is 0%; when recruits are between $S_{gen}$ and the upper OCP escapement is fixed at $S_{gen}$, and when recruits are greater than the upper OCP ER is fixed at $U_{MSY}$ (Figure \@ref(figure:HCRs)).  

To address uncertainty in estimation of productivity, and to provide resilience to changing productivity forward in the simulation, we also conducted a robustness test that tested a low productivity scenario. 
Each HCR was tested at its reference (i.e. baseline) and robustness (i.e. low productivity) level. 
Baseline tests sampled the full posterior and robustness test sampled the lower 10th percentile of joint draws from the posterior of the productivity parameter (Ricker $\alpha$).  


### Simulation methods  

For each HCR and productivity scenario, we took joint draws of posteriors for parameters and starting states in `r max(data$year)` 1000 times with replacement then projected population dynamics and management scenarios forward 5 generations. 
Uncertainty in management was accounted for by including forecast error and outcome uncertainty. 
Forecast error was empirically calculated based on pre-season forecasts provided by the PSC (*edit after March 8th about correcting for in-season adjustments*). 
Lognormal forecast error was applied to recruits before applying the HCR, then outcome uncertainty applied to catch in the HCR functions.    
Outcome uncertainty was normally distributed with a CV of `r OU.CV`, which has **justifications from...** (*Holt & Peterman 2011*).  


### Simulation performance  

Simulations were evaluated for each HCR and productivity regime across five metrics that encompass aspects of conservation risk and fishery objectives. 
Conservation risk was assessed by calculating 1) the percentage of years where escapement fell above $S_{MSY}$, and 2) the percentage of years where escapement fell below $S_{gen}$. 
Fishery objectives were addressed by calculating 3) annual catch, 4) catch stability (1/CV), and 5) a relative catch index; or the percentage of years that fell below an ad hoc threshold, defined as the mean catch of the highest three catches since the year 2000.   
